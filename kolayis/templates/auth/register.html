{% extends "base.html" %}
{% block title %}Kayit Ol - KolayIS{% endblock %}

{% block auth_content %}
<div class="min-h-screen bg-gradient-to-br from-sidebar via-brand-900 to-brand-800 flex items-center justify-center p-4">
    <div class="max-w-md w-full space-y-8">
        <div class="text-center">
            <h1 class="text-4xl font-bold text-white tracking-wide">Kolay<span class="text-brand-400">IS</span></h1>
            <p class="mt-3 text-brand-200">Yeni hesap olusturun</p>
        </div>

        {% if error %}
        <div class="bg-red-500/10 border border-red-500/20 text-red-200 rounded-xl p-4 text-sm">
            {{ error }}
        </div>
        {% endif %}

        <form method="POST" action="/auth/register" class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 space-y-6 border border-white/10">
            <div>
                <label for="full_name" class="block text-sm font-medium text-brand-200">Ad Soyad</label>
                <input type="text" name="full_name" id="full_name" required
                    class="mt-1 block w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-brand-300 focus:outline-none focus:ring-2 focus:ring-brand-400 focus:border-transparent"
                    placeholder="Adiniz Soyadiniz">
            </div>
            <div>
                <label for="email" class="block text-sm font-medium text-brand-200">Email</label>
                <input type="email" name="email" id="email" required
                    class="mt-1 block w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-brand-300 focus:outline-none focus:ring-2 focus:ring-brand-400 focus:border-transparent"
                    placeholder="ornek@email.com">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-brand-200">Sifre</label>
                <input type="password" name="password" id="password" required minlength="8"
                    class="mt-1 block w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-brand-300 focus:outline-none focus:ring-2 focus:ring-brand-400 focus:border-transparent"
                    placeholder="En az 8 karakter">
            </div>

            {% if turnstile_site_key %}
            <!-- Ben robot degilim -->
            <div id="captcha-box" onclick="startVerification()" style="border:1px solid rgba(255,255,255,0.2); border-radius:12px; background:rgba(255,255,255,0.05); padding:14px 16px; cursor:pointer; display:flex; align-items:center; gap:12px; transition:all 0.2s;">
                <div id="checkbox" style="width:24px; height:24px; border:2px solid rgba(255,255,255,0.3); border-radius:6px; flex-shrink:0; display:flex; align-items:center; justify-content:center; transition:all 0.3s;"></div>
                <span id="captcha-text" style="color:#93c5fd; font-size:14px;">Ben robot degilim</span>
            </div>
            <div id="turnstile-container" style="display:none;"></div>

            <button type="submit" id="submitBtn" disabled
                style="opacity:0.5; cursor:not-allowed;"
                class="w-full flex justify-center py-3 px-4 rounded-xl text-sm font-semibold text-white bg-brand-500 transition-colors">
                Kayit Ol
            </button>
            {% else %}
            <button type="submit"
                class="w-full flex justify-center py-3 px-4 rounded-xl text-sm font-semibold text-white bg-brand-500 hover:bg-brand-600 transition-colors">
                Kayit Ol
            </button>
            {% endif %}
        </form>

        <p class="text-center text-sm text-brand-300">
            Zaten hesabiniz var mi?
            <a href="/auth/login" class="text-brand-400 hover:text-brand-300 font-medium">Giris Yap</a>
        </p>
    </div>
</div>

<script>
var turnstileAPIReady = false;
var verifying = false;

window.onTurnstileAPIReady = function() { turnstileAPIReady = true; };

function startVerification() {
    if (verifying) return;

    if (!turnstileAPIReady) {
        document.getElementById('captcha-text').textContent = 'Yukleniyor...';
        setTimeout(startVerification, 500);
        return;
    }

    verifying = true;

    document.getElementById('checkbox').innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#93c5fd" stroke-width="3" style="animation:spin 0.8s linear infinite;"><path d="M12 2a10 10 0 0 1 10 10"></path></svg>';
    document.getElementById('captcha-text').textContent = 'Dogrulaniyor...';
    document.getElementById('captcha-box').style.cursor = 'default';

    window.turnstile.render('#turnstile-container', {
        sitekey: '{{ turnstile_site_key }}',
        theme: 'dark',
        callback: function(token) {
            document.getElementById('checkbox').style.background = '#4ade80';
            document.getElementById('checkbox').style.borderColor = '#4ade80';
            document.getElementById('checkbox').innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><path d="M20 6L9 17l-5-5"></path></svg>';
            document.getElementById('captcha-text').textContent = 'Dogrulama basarili';
            document.getElementById('captcha-text').style.color = '#4ade80';
            document.getElementById('captcha-box').style.borderColor = 'rgba(74,222,128,0.4)';

            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitBtn').style.opacity = '1';
            document.getElementById('submitBtn').style.cursor = 'pointer';
        },
        'error-callback': function() {
            document.getElementById('checkbox').style.borderColor = '#f87171';
            document.getElementById('checkbox').innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="3"><path d="M18 6L6 18M6 6l12 12"></path></svg>';
            document.getElementById('captcha-text').textContent = 'Basarisiz, sayfayi yenileyin';
            document.getElementById('captcha-text').style.color = '#f87171';
            document.getElementById('captcha-box').style.borderColor = 'rgba(248,113,113,0.4)';
            verifying = false;
        }
    });
}
</script>
<style>
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
#captcha-box:hover { background: rgba(255,255,255,0.08) !important; }
</style>
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit&onload=onTurnstileAPIReady" async defer></script>
{% endblock %}
