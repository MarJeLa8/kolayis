{% extends "base.html" %}
{% block title %}Kullanici Duzenle - KolayIS{% endblock %}
{% block page_title %}Kullanici Duzenle{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-6">
    <!-- Geri butonu -->
    <div>
        <a href="/admin/users" class="inline-flex items-center text-sm text-gray-500 dark:text-gray-400 hover:text-brand-600 dark:hover:text-brand-400 transition-colors">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            Kullanici Listesine Don
        </a>
    </div>

    {% if success %}
    <div class="bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-xl p-4 text-sm border border-green-100 dark:border-green-800">
        {{ success }}
    </div>
    {% endif %}
    {% if error %}
    <div class="bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-300 rounded-xl p-4 text-sm border border-red-100 dark:border-red-800">
        {{ error }}
    </div>
    {% endif %}

    <!-- Kullanici bilgi karti -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-6">
        <div class="flex items-center space-x-4 mb-6 pb-6 border-b border-gray-100 dark:border-gray-700">
            <div class="w-14 h-14 rounded-full flex items-center justify-center text-xl font-bold
                {% if edit_user.role == 'admin' %}bg-red-100 dark:bg-red-900/40 text-red-600 dark:text-red-400
                {% elif edit_user.role == 'manager' %}bg-amber-100 dark:bg-amber-900/40 text-amber-600 dark:text-amber-400
                {% else %}bg-brand-100 dark:bg-brand-900/40 text-brand-600 dark:text-brand-400{% endif %}">
                {{ edit_user.full_name[0] }}
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">{{ edit_user.full_name }}</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">{{ edit_user.email }}</p>
                <p class="text-xs text-gray-400 dark:text-gray-500 mt-0.5">
                    Kayit: {{ edit_user.created_at.strftime('%d.%m.%Y %H:%M') if edit_user.created_at else '-' }}
                </p>
            </div>
        </div>

        <form method="POST" action="/admin/users/{{ edit_user.id }}/edit" class="space-y-6">
            <!-- Rol secimi -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Kullanici Rolu</label>
                <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Kullanicinin sistemdeki erisim seviyesini belirler.</p>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3" id="roleSelector">
                    <!-- Admin -->
                    <label class="role-option relative cursor-pointer">
                        <input type="radio" name="role" value="admin" class="sr-only peer"
                            {% if edit_user.role == 'admin' %}checked{% endif %}>
                        <div class="p-4 rounded-xl border-2 border-gray-200 dark:border-gray-600 peer-checked:border-red-500 dark:peer-checked:border-red-500 peer-checked:bg-red-50 dark:peer-checked:bg-red-900/20 hover:border-gray-300 dark:hover:border-gray-500 transition-all">
                            <div class="flex items-center space-x-2 mb-2">
                                <div class="w-8 h-8 rounded-lg bg-red-100 dark:bg-red-900/40 flex items-center justify-center">
                                    <svg class="w-4 h-4 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                                </div>
                                <span class="text-sm font-semibold text-gray-900 dark:text-gray-100">Admin</span>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Tam erisim. Tum islemleri yapabilir, kullanicilari yonetebilir.</p>
                        </div>
                    </label>
                    <!-- Manager / Yonetici -->
                    <label class="role-option relative cursor-pointer">
                        <input type="radio" name="role" value="manager" class="sr-only peer"
                            {% if edit_user.role == 'manager' %}checked{% endif %}>
                        <div class="p-4 rounded-xl border-2 border-gray-200 dark:border-gray-600 peer-checked:border-amber-500 dark:peer-checked:border-amber-500 peer-checked:bg-amber-50 dark:peer-checked:bg-amber-900/20 hover:border-gray-300 dark:hover:border-gray-500 transition-all">
                            <div class="flex items-center space-x-2 mb-2">
                                <div class="w-8 h-8 rounded-lg bg-amber-100 dark:bg-amber-900/40 flex items-center justify-center">
                                    <svg class="w-4 h-4 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                                </div>
                                <span class="text-sm font-semibold text-gray-900 dark:text-gray-100">Yonetici</span>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Musteriler, urunler, faturalar, raporlar uzerinde tam yetki.</p>
                        </div>
                    </label>
                    <!-- User / Kullanici -->
                    <label class="role-option relative cursor-pointer">
                        <input type="radio" name="role" value="user" class="sr-only peer"
                            {% if edit_user.role == 'user' %}checked{% endif %}>
                        <div class="p-4 rounded-xl border-2 border-gray-200 dark:border-gray-600 peer-checked:border-blue-500 dark:peer-checked:border-blue-500 peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/20 hover:border-gray-300 dark:hover:border-gray-500 transition-all">
                            <div class="flex items-center space-x-2 mb-2">
                                <div class="w-8 h-8 rounded-lg bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center">
                                    <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                </div>
                                <span class="text-sm font-semibold text-gray-900 dark:text-gray-100">Kullanici</span>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Sinirli erisim. Okuma ve temel olusturma yetkileri.</p>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Aktif/Pasif toggle -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Hesap Durumu</label>
                <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Pasif yapilan kullanicilar sisteme giris yapamaz.</p>
                <div class="flex items-center space-x-3">
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" name="is_active" value="1" class="sr-only peer"
                            {% if edit_user.is_active %}checked{% endif %}
                            {% if edit_user.id == user.id %}disabled{% endif %}>
                        <div class="w-11 h-6 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-brand-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                    <span class="text-sm text-gray-700 dark:text-gray-300" id="statusLabel">
                        {% if edit_user.is_active %}Aktif{% else %}Pasif{% endif %}
                    </span>
                    {% if edit_user.id == user.id %}
                    <span class="text-xs text-amber-600 dark:text-amber-400">(Kendi hesabinizi pasif yapamazsiniz)</span>
                    {% endif %}
                </div>
            </div>

            <!-- 2FA bilgisi (salt okunur) -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Iki Faktorlu Dogrulama (2FA)</label>
                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                    {% if edit_user.totp_secret %}
                    <div class="flex items-center space-x-2">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span>
                        <span class="text-sm text-green-700 dark:text-green-400 font-medium">2FA Aktif</span>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Bu kullanicinin iki faktorlu dogrulamasi aktif durumda.</p>
                    {% else %}
                    <div class="flex items-center space-x-2">
                        <span class="w-2 h-2 rounded-full bg-gray-400"></span>
                        <span class="text-sm text-gray-500 dark:text-gray-400 font-medium">2FA Pasif</span>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Bu kullanici henuz iki faktorlu dogrulamayi aktif etmemis.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Kaydet butonu -->
            <div class="flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700">
                <a href="/admin/users" class="px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                    Iptal
                </a>
                <button type="submit"
                    class="px-6 py-2.5 bg-brand-600 text-white text-sm font-medium rounded-lg hover:bg-brand-700 transition-colors">
                    Degisiklikleri Kaydet
                </button>
            </div>
        </form>
    </div>

    <!-- Yetki tablosu -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-6">
        <h3 class="text-base font-semibold text-gray-900 dark:text-gray-100 mb-4">Rol Yetkileri</h3>
        <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Secilen role gore kullanicinin erisebilecegi alanlar asagida gosterilmistir.</p>
        <div class="overflow-hidden rounded-lg border border-gray-200 dark:border-gray-600">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                <thead class="bg-gray-50 dark:bg-gray-700/50">
                    <tr>
                        <th class="px-4 py-2.5 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Modul</th>
                        <th class="px-4 py-2.5 text-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Admin</th>
                        <th class="px-4 py-2.5 text-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Yonetici</th>
                        <th class="px-4 py-2.5 text-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Kullanici</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                    <tr>
                        <td class="px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300">Musteriler</td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-amber-500">Oku / Olustur</span></td>
                    </tr>
                    <tr>
                        <td class="px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300">Urunler</td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-amber-500">Sadece Oku</span></td>
                    </tr>
                    <tr>
                        <td class="px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300">Faturalar</td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-amber-500">Oku / Olustur</span></td>
                    </tr>
                    <tr>
                        <td class="px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300">Raporlar</td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-red-500">Erisim Yok</span></td>
                    </tr>
                    <tr>
                        <td class="px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300">Kullanici Yonetimi</td>
                        <td class="px-4 py-2.5 text-center"><span class="text-green-500">Tam</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-red-500">Erisim Yok</span></td>
                        <td class="px-4 py-2.5 text-center"><span class="text-red-500">Erisim Yok</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Toggle durumunu guncelle
(function() {
    var toggle = document.querySelector('input[name="is_active"]');
    var label = document.getElementById('statusLabel');
    if (toggle && label) {
        toggle.addEventListener('change', function() {
            label.textContent = this.checked ? 'Aktif' : 'Pasif';
        });
    }
})();
</script>
{% endblock %}
